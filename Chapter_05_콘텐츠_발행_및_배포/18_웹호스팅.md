# 18. 웹 호스팅
- 웹 호스팅이란? 콘텐츠 리소스를 저장, 중개, 관리하는 일
- 직접 컴퓨터 하드웨어를 구매하고 자체 망을 구축하며 자체 네트워크 연결을 확보하는 대신 전문적으로 관리하는 웹 호스팅 서비스업체에 맡김 -> 물리적 장비 관리, 콘텐츠 제공
- 웹 서버를 임대

## 가상 호스팅
- 컴퓨터 한 대를 여러 고객이 공유하게 하여 저렴하게 웹 호스팅 서비르를 제공 -> 물리적으로 같은 서버에서 호스팅됨
- 비용, 공간, 관리에 이점
- HTTP/1.0에서는 공용 웹서버가 호스팅하는 가상 웹사이트에 누가 접근하는지 식별하는 기능을 제공하지 않는다.
  - 요청 메세지에 url 경로 컴포넌트만 전송함 -> 서버가 여러 사이트를 가상 호스팅하고 있으면 사용자가 어떤 웹서비스로 접근하려는지 파악하기 위한 정보가 부족
- HTTP/1.1에서는 요청메세지에 전체 url을 포함
1. url 경로를 통한 가상 호스팅
   1. 공용 서버에 있는 각 가상사이트에 다른 url 경로를 할당해서 강제로 구분
   2. 서버에 요청에 도착하면 호스트명 정보가 요청에 포함되어 있진 않아도 경로에 있는 정보를 통해 이해 가능 예) GET /joe/index.html, GET /mary/index.html
   3. 그러나 이건 불필요하고 혼란스러운 접두어 포함하여 잘 사용하지 않음
2. 포트 번호를 통한 가상 호스팅
   1. 경로명 변경 대신 웹서버에 각각 다른 포트번호 할당
   2. 사용자는 url에 비표준 포트를 쓰지 않아도 리소스를 찾길 원하므로 문제가 있음
3. IP 주소를 통한 가상 호스팅
   1. 가상 IP를 할당함
   2. 각 가상 웹사이트에 유일한 IP 주소를 한 개 이상 부여 -> 모든 가상 서버의 ip주소는 같은 공용 서버에 연결됨
   3. 클라이언트가 ip주소를 얻어 TCP커넥션을 맺고 요청을 보냄 -> 웹 서버에서 응답 전송 전 IP 주소를 기록하고 그에 맞는 리소스를 찾아 응답
   4. 연결할수 있는 장비의 ip 개수가 제한적
   5. ip주소를 희소 상품이라 가상 사이트를 많이 가지고 있는 호스팅 업자는 모든 가상 ip 주소를 충분히 얻지 못 할 수 있다
   6. ip가 부족하여 용량을 늘리려고 서버를 복제하면서 복제된 서버에 ip주소를 부여해야 하므로 문제는 더 심각해짐
4. HOST 헤더를 통한 가상 호스팅
   1. 가상 사이트들이 같은 ip를 사용하더라도 각 사이트가 어디에 속해 있는 지 알 수 있어야 함
   2. 서버가 원 호스트명을 받아볼 수 있게 HTTP확장 -> 모든 요청에 호스트명, 포트를 Host 확장 헤더에 기술해서 전달
   3. HTTP/1.0+에서 소개

## HTTP/1.1 Host 헤더
- ```Host - "Hosy": ":"호스트[ ":" 포트]``` 형태로 기술
- 포트가 기술되어 있지않으면 스킴의 기본 포트 사용
- ip주소가 있으면 host헤더는 같은 주소를 포함해야 함
- 호스트명이 기술되어 있으면 같은 호스트명을 포함해야 하고 url의 호스트명이 가리키는 ip주소를 포함하면 안된다.
  (가상 사이트를 한개의 ip주소에 여러 가상 사이트를 연결한 호스트 서버에서 문제될 수 있음)
- 특정 프락시 서버를 사용한다면 Host헤더에 프락시 서버가 아닌 원 서버의 호스트명과 포트를 기술한다
- 모든 요청메세지에 Host헤더를 기술해야 한다
- 프락시는 요청 전달 전 Host 헤더를 추가해야 한다. 이 헤더가 없는 요청을 받은 400 상태코드로 반환
- HTTP 요청메세지에 전체 url이 기술되어 있으면 Host 헤더에 있는 값은 무시하고 url사용
- 요청메세지에 있는 url에 호스트명이 기술되어 있지 않고 Host헤더가 있으면 호스트 명과 포트를 Host헤더에서 가져온다

## 안정적인 웹사이트 만들기
- 서버팜: 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합 -> 한쪽에 문제가 생기면 다른 한곳에서 전달할 수 있게 미러링 할 수 있다.
- 콘텐츠의 원본 제작자(마스터 원 서버) => 복제 원 서버(마스터로 부터 콘텐츠를 받은 미러링된 서버)
- 네트워크 스위치를 사용하여 서버에 분산요청 보냄
- 서버에 호스팅되고 있는 각 웹사이트의 ip주소는 스위치의 ip주소가 됨
- 스위치는 서버에게 요청을 전송해야하는 책임이 있다.
- 마스터 서버는 복제 서버들에게 콘텐츠를 퍼뜨림
- HTTP 리다이렉션: 콘텐츠 url은 마스터 서버의 ip를 가리키고 마스터 서버는 요청을 받는 즉시 복제 서버로 리다이렉트 시킨다
- DNS 리다이렉션: 콘텐츠 url은 네 개의 ip를 가리킬 수 있고 DNS 서버는 클라이언트에게 전송한 ip주소를 선택할 수 있다.
- 콘텐츠 분산 네트워크(CDN)는 특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크 
  - 네트워크의 노드는 서버, 대리서버, 프락시 서버가 될 수 있다.
  - 대리캐시(리버스 프락시)는 복제 원서버를 대신해 사용될 수 있다.
  - 대리서버는 미러링된 웹서버처럼 콘텐츠 요청을 받는다. 특정 원 서버 집합을 대신해 요청을 받음
  - 대리서버와 미러링된 서버의 차이
    - 대리서버는 수요에 따라서 동작. 원 서버의 전체 콘텐츠를 복사하지 않음. 콘텐츠가 요청하는 콘텐츠만 저장
    - 대리서버의 캐시에 콘텐츠가 분산되는 방식은 요청에 따라 달라짐
  - 대리서버를 사용하면 프락시 캐시는 요청이 있을때만 저장되고 원 서버의 콘텐츠를 정확히 복제한다는 보장이 없다.
  - 중간에서 웹 트래픽을 가로채 처리하기도 함 - 클라이언트와 서버 사이의 모든 요청이 물리적으로 캐시를 거치게 네트워크 설정을 할 수 있는지에 따라 달라짐
  - 